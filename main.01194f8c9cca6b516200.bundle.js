(()=>{"use strict";class t{constructor(){this.initialized=!1,this.canvas=document.createElement("canvas"),this.canvas.width=500,this.canvas.height=750,this.canvas.style.display="block",this.canvas.style.margin="0 auto",this.canvas.style.position="relative",this.canvas.style.background="#fff",document.body.style.display="flex",document.body.style.justifyContent="center",document.body.style.alignItems="center";const t=this.canvas.getContext("2d");if(!t)throw new Error("cudcnd");this.ctx=t,document.body.appendChild(this.canvas),this.initialized=!0}render(t,e=0,i=0){this.initialized||(this.canvas.width=Math.max(t.width,400),this.canvas.height=Math.max(t.height,400),document.body.appendChild(this.canvas),this.initialized=!0),this.ctx.drawImage(t,e,i)}drawRect(t,e,i,s){this.ctx.save(),this.ctx.strokeStyle="red",this.ctx.lineWidth=2,this.ctx.strokeRect(t,e,i,s),this.ctx.restore()}drawFrame(t,e,i,s,n,o,h,a,r){this.ctx.drawImage(t,e,i,s,n,o,h,a,r)}getCanvas(){return this.canvas}}class e{constructor(){this.listHitbox=[]}addHitBox(t){this.listHitbox.push(t)}update(t){}render(t){}check(){for(let t=0;t<this.listHitbox.length;t++)for(let e=t+1;e<this.listHitbox.length;e++)if(this.listHitbox[t].intersects(this.listHitbox[e]))return!0;return!1}}class i{constructor(){}}class s extends i{Init(){}constructor(t,e,i){super(),this.currentFrame=0,this.clock=0,this.texture=t,this.numFrame=e,this.frameTime=i,this.frameParam={x:Math.floor(t.width/e.x),y:Math.floor(t.height/e.y)},this.totalFrames=e.x*e.y}update(t){this.clock+=t,this.clock>=this.frameTime&&(this.currentFrame=(this.currentFrame+1)%this.totalFrames,this.clock-=this.frameTime)}render(t,e,i){const s=this.currentFrame%this.numFrame.x,n=Math.floor(this.currentFrame/this.numFrame.x);t.drawFrame(this.texture,s*this.frameParam.x,n*this.frameParam.y,this.frameParam.x,this.frameParam.y,e,i,this.frameParam.x,this.frameParam.y)}reset(){this.currentFrame=0,this.clock=0}}class n extends i{constructor(t,e,i={x:0,y:0},s={x:0,y:0},n=980,o=!0){super(),this.totalTime=0,this.hitbox=e,this.position=t,this.velocity=i,this.acceleration=s,this.gravity=n,this.useGravity=o,this.startY=t.y,this.startX=t.x}Init(){}update(t){this.velocity.y+=this.gravity*t,this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.hitbox.setPosition(this.position)}render(){}getVelocity(){return this.velocity}getPosition(){return this.position}setPosition(t){this.position=t}setVelocity(t){this.velocity=t}setAcceleration(t){this.acceleration=t}setGravity(t){this.gravity=t}enableGravity(t){this.useGravity=t}addForce(t){this.velocity.x+=t.x,this.velocity.y+=t.y}}class o{constructor(){this.path_name="assets/images/",this.texture_path=this.path_name,this.map_texture=new Map}static getInstance(){return o.instance||(o.instance=new o),o.instance}addTexture(t){if(this.map_texture.has(t))return;const e=new Image;e.src=this.texture_path+t+".png",this.map_texture.set(t,e)}getTexture(t){let e=this.map_texture.get(t);return e||(e=new Image,e.src=this.texture_path+t+".png",this.map_texture.set(t,e),e)}}class h{static initialize(t){h.canvas=t,t.addEventListener("mousemove",(e=>{const i=t.getBoundingClientRect();h.mouse={x:e.clientX-i.left,y:e.clientY-i.top}})),t.addEventListener("mousedown",(()=>{h.mouseDown=!0})),t.addEventListener("mouseup",(()=>{h.mouseDown=!1})),window.addEventListener("keydown",(t=>{h.keys.add(t.key.toLowerCase())})),window.addEventListener("keyup",(t=>{h.keys.delete(t.key.toLowerCase())}))}static isKeyDown(t){return h.keys.has(t.toLowerCase())}static getMouse(){return h.mouse}static isMouseDown(){return h.mouseDown}}h.keys=new Set,h.mouse={x:0,y:0},h.mouseDown=!1,h.canvas=null;class a extends i{constructor(t,e){super(),this.mouseDownLastFrame=!1,this.size=t,this.pos=e}Init(){}setOnClick(t){this.onClickCallback=t}isMouseInside(t){return t.x>=this.pos.x&&t.x<=this.pos.x+this.size.x&&t.y>=this.pos.y&&t.y<=this.pos.y+this.size.y}update(t){const e=h.getMouse(),i=h.isMouseDown();e&&i&&!this.mouseDownLastFrame&&this.isMouseInside(e)&&this.onClickCallback&&this.onClickCallback(),this.mouseDownLastFrame=!!i}handleMouseDown(t){this.isMouseInside(t)&&this.onClickCallback&&this.onClickCallback()}render(t,e=this.pos.x,i=this.pos.y){}}class r extends i{constructor(t,e,i){super(),this.pos=t,this.width=e,this.height=i,this.active=!0}setPosition(t){this.pos=t}Init(){}update(t){}getPosX(){return this.pos.x}render(t,e,i){}getPosY(){return this.pos.y}setDeActive(){this.active=!1}getWidth(){return this.width}getHeight(){return this.height}intersects(t){return!(this.pos.x+this.width<t.getPosX()||this.pos.x>t.getPosX()+t.getWidth()||this.pos.y+this.height<t.getPosY()||this.pos.y>t.getPosY()+t.getHeight())}}class c{constructor(t,e){this._listComponent=[],this._position=t,this._size=e,this._active=!0,this.HitBox=new r(t,e.width,e.height),this.AddComponent(this.HitBox)}AddImage(t){this.image=t}SetCollision(){this.HitBox.setDeActive()}AddComponent(t){if(this._listComponent.find((e=>e.constructor.name===t.constructor.name)))throw new Error("co roi");this._listComponent.push(t)}setPosition(t){this._position=t}Update(t){if(this._active){this.setPosition({x:this.hitbox.getPosX(),y:this.hitbox.getPosY()});for(const e of this._listComponent)e.update&&e.update(t)}}Render(t){this.image&&t.render(this.image,this.hitbox.getPosX(),this.hitbox.getPosY());for(const e of this._listComponent)e.render&&e.render(t,this.HitBox.getPosX(),this.HitBox.getPosY())}getComponentByName(t){const e=this._listComponent.find((e=>e.constructor.name===t));if(!e)throw new Error("deo co");return e}get position(){return this._position}get hitbox(){return this.HitBox}get size(){return this._size}get active(){return this._active}set active(t){this._active=t}}var l;!function(t){t[t.DashboardScene=0]="DashboardScene",t[t.PlayScene=1]="PlayScene",t[t.SettingScene=2]="SettingScene",t[t.HighScoreScene=3]="HighScoreScene",t[t.EndScene=4]="EndScene"}(l||(l={}));class d{constructor(){}pause(){}Init(){}update(t){}exit(){}resume(){}render(t){}}class m extends d{constructor(){super(),this.listGame=[],this.isJump=!1,this.PlayButton=new c({x:200,y:300},{width:100,height:50}),this.Background=new c({x:0,y:0},{width:900,height:900}),this.Player=new c({x:80,y:480},{width:60,height:60}),this.base=new c({x:80,y:540},{width:60,height:20}),this.Collision=new e,this.Physic2D=new n({x:80,y:480},this.Player.getComponentByName("HitBox")),this.Player.AddComponent(this.Physic2D),this.Butt=new a({x:100,y:50},{x:200,y:300}),this.anim1=new s(o.getInstance().getTexture("blue-lik-left"),{x:1,y:1},.1),this.listGame.push(this.Background),this.listGame.push(this.PlayButton),this.listGame.push(this.Player),this.listGame.push(this.base)}Init(){this.Player.AddComponent(this.anim1),this.PlayButton.AddImage(o.getInstance().getTexture("play")),this.Background.AddImage(o.getInstance().getTexture("loading")),this.PlayButton.AddComponent(this.Butt),this.Collision.addHitBox(this.Player.hitbox),this.Collision.addHitBox(this.base.hitbox),this.Butt.setOnClick((()=>{g.getInstance().pushScene(l.PlayScene)}))}update(t){for(const e of this.listGame)e.Update(t);this.Collision.check()?this.isJump||(this.Physic2D.setVelocity({x:0,y:-500}),this.isJump=!0):this.isJump=!1}render(t){var e;const i=this.Background.image;if(i){const s=t.getCanvas(),n=i.width,o=i.height,h=Math.min(s.width/n,s.height/o),a=n*h,r=o*h,c=(s.width-a)/2,l=(s.height-r)/2;null===(e=s.getContext("2d"))||void 0===e||e.drawImage(i,c,l,a,r)}for(const e of this.listGame)e!==this.Background&&e.Render(t)}}class u extends c{constructor(t,e,i="normal"){super({x:t,y:e},{width:90,height:15}),this.platformType=i,this.isActive=!0,this.originalX=t,this.moveDirection=1,this.moveSpeed=50,this.moveRange=100,this.initializePlatform()}initializePlatform(){let t="platform";switch(this.platformType){case"normal":case"moving":t="platform";break;case"spring":t="spring";break;case"invi":t="invi"}this.AddImage(o.getInstance().getTexture(t))}Update(t){this.isActive&&("moving"===this.platformType&&this.updateMovingPlatform(t),super.Update(t))}updateMovingPlatform(t){this.position.x+=this.moveSpeed*this.moveDirection*t,this.position.x<=this.originalX-this.moveRange?(this.moveDirection=1,this.position.x=this.originalX-this.moveRange):this.position.x>=this.originalX+this.moveRange&&(this.moveDirection=-1,this.position.x=this.originalX+this.moveRange),this.position.x<0?(this.position.x=0,this.moveDirection=1):this.position.x>400-this.size.width&&(this.position.x=400-this.size.width,this.moveDirection=-1),this.hitbox.setPosition(this.position)}onPlayerLand(){switch(this.platformType){case"normal":case"moving":return-500;case"spring":return-1e3;case"invi":return this.breakPlatform(),-500;default:return-400}}breakPlatform(){this.isActive=!1,setTimeout((()=>{this.isActive=!0}),2e3)}resetPosition(t,e){this.position.x=t,this.position.y=e,this.originalX=t,this.isActive=!0,this.hitbox.setPosition(this.position)}setRandomPosition(t,e){const i=Math.random()*(400-this.size.width),s=t+Math.random()*(e-t);this.resetPosition(i,s)}get platformTyp(){return this.platformType}get isActivePlatform(){return this.isActive}Render(t){this.isActive&&super.Render(t)}}class y extends d{constructor(){super(),this.listPlatform=[],this.isJump=!1,this.cameraY=0,this.playerFixedY=300,this.Collision=new e,this.Player=new c({x:200,y:this.playerFixedY},{width:40,height:40}),this.anim1=new s(o.getInstance().getTexture("blue-lik-left"),{x:1,y:1},.1),this.Physic2D=new n({x:200,y:this.playerFixedY},this.Player.getComponentByName("HitBox")),this.Background=new c({x:0,y:0},{width:900,height:900}),this.createPlatforms()}createPlatforms(){for(let t=0;t<20;t++){const e=400*Math.random(),i=600+-100*t;let s="normal";if(t>2){const t=Math.random();s=t<.7?"normal":t<.85?"spring":t<.95?"moving":"invi"}const n=new u(e,i,s);this.Collision.addHitBox(n.hitbox),this.listPlatform.push(n)}}Init(){this.Collision.addHitBox(this.Player.hitbox),this.Player.AddComponent(this.anim1),this.Player.AddComponent(this.Physic2D),this.Background.AddImage(o.getInstance().getTexture("background"))}update(t){const e=this.Physic2D.getVelocity();h.isKeyDown("ArrowRight")?this.Physic2D.setVelocity({x:300,y:e.y}):h.isKeyDown("ArrowLeft")?this.Physic2D.setVelocity({x:-300,y:e.y}):this.Physic2D.setVelocity({x:0,y:e.y}),this.Player.position.x>400?(this.Player.position.x=0,this.Physic2D.setPosition({x:0,y:this.Player.position.y})):this.Player.position.x<0&&(this.Player.position.x=400,this.Physic2D.setPosition({x:400,y:this.Player.position.y})),this.Player.Update(t);for(let e of this.listPlatform)e.Update(t);const i=this.Physic2D.getVelocity().y;if(this.Player.position.y<this.playerFixedY&&i<0){const t=this.playerFixedY-this.Player.position.y;for(let e of this.listPlatform)e.position.y+=t,e.hitbox.setPosition(e.position);this.Player.position.y=this.playerFixedY,this.Physic2D.setPosition({x:this.Player.position.x,y:this.playerFixedY}),this.cameraY+=t}this.recyclePlatforms(),this.checkPlayerPlatformCollision()?!this.isJump&&i>0&&(this.isJump=!0):this.isJump=!1,this.Player.position.y>800&&g.getInstance().pushScene(l.DashboardScene)}recyclePlatforms(){let t=Math.min(...this.listPlatform.map((t=>t.position.y)));for(let e of this.listPlatform)if(e.position.y>900){const i=400*Math.random(),s=t-(80+40*Math.random());e.resetPosition(i,s),t=s}}checkPlayerPlatformCollision(){const t=this.Player.hitbox;for(let e of this.listPlatform)if(e.isActivePlatform&&t.intersects(e.hitbox)){const t=this.Player.position.y+this.Player.size.height,i=e.position.y;if(Math.abs(t-i)<10){const t=e.onPlayerLand();return this.Physic2D.setVelocity({x:this.Physic2D.getVelocity().x,y:t}),!0}}return!1}restartGame(){this.Player.position.y=this.playerFixedY,this.Player.position.x=200,this.Physic2D.setPosition({x:200,y:this.playerFixedY}),this.Physic2D.setVelocity({x:0,y:0}),this.cameraY=0;for(let t=0;t<this.listPlatform.length;t++){const e=332*Math.random(),i=600+-100*t;this.listPlatform[t].resetPosition(e,i)}}render(t){this.Background.Render(t);for(const e of this.listPlatform)e.Render(t);this.Player.Render(t)}}function p(t){switch(t){case l.DashboardScene:return new m;case l.PlayScene:return new y;default:throw new Error(`Unknown scene type: ${t}`)}}class g{constructor(){this.stack=[],this.currentScene=null,this.nextScene=null}static getInstance(){return g.instance||(g.instance=new g),g.instance}changeScene(t){this.nextScene=t}changeSceneByName(t){const e=p(t);this.changeScene(e)}pushScene(t){const e=p(t);this.stack.length>0&&this.stack[this.stack.length-1].pause(),this.nextScene=e}popScene(){this.stack.length>0&&(this.stack[this.stack.length-1].exit(),this.stack.pop()),this.stack.length>0&&this.stack[this.stack.length-1].resume(),this.currentScene=this.stack[this.stack.length-1]}performSceneChange(){this.nextScene&&(this.stack.length>0&&this.stack[this.stack.length-1].exit(),this.stack.push(this.nextScene),this.stack[this.stack.length-1].Init(),this.currentScene=this.nextScene,this.nextScene=null)}needToChangeScene(){return null!==this.nextScene}getCurrentScene(){return this.currentScene}getNextScene(){return this.nextScene}hasScene(){return this.stack.length>0}}new class{constructor(){}},(new class{constructor(){this.lastTime=0}Init(){g.getInstance().changeSceneByName(l.DashboardScene),this.Renderer=new t,h.initialize(this.Renderer.getCanvas())}Run(){this.Init(),this.lastTime=performance.now();const t=()=>{const e=performance.now(),i=(e-this.lastTime)/1e3;this.lastTime=e,this.Update(i),this.Render(),requestAnimationFrame(t)};requestAnimationFrame(t)}Update(t){var e;g.getInstance().needToChangeScene()&&g.getInstance().performSceneChange(),null===(e=g.getInstance().getCurrentScene())||void 0===e||e.update(t)}Render(){var t;null===(t=g.getInstance().getCurrentScene())||void 0===t||t.render(this.Renderer)}}).Run()})();